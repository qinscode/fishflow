import AsyncStorage from '@react-native-async-storage/async-storage';
import { useCallback } from 'react';
import { useAppStore } from './store';

export type Language = 'zh' | 'en' | 'system';
export type TranslationKeys = keyof typeof translations.zh;

const LANGUAGE_STORAGE_KEY = '@fishflow/language';

export const translations = {
  zh: {
    // Navigation
    'nav.home': '首页',
    'nav.fishdex': '图鉴',
    'nav.equipment': '装备',
    'nav.achievements': '成就',
    'nav.stats': '统计',
    'nav.settings': '设置',
    'nav.log': '记录',

    // Home Screen
    'home.title': '首页',
    'home.welcome': '欢迎回到 FishFlow',
    'home.subtitle': '继续你的钓鱼之旅',
    'home.stats.catches': '钓获数',
    'home.stats.species': '鱼种数',
    'home.stats.achievements': '成就数',
    'home.stats.days': '钓鱼天数',
    'home.quick.log': '记录钓获',
    'home.quick.logs': '查看钓鱼日志',
    'home.quick.fishdex': '查看图鉴',
    'home.quick.equipment': '管理装备',
    'home.quick.actions': '快速操作',
    'home.recent.unlocks': '最近解锁',
    'home.recent.achievements': '最新成就',
    'home.recent.empty': '暂无数据',
    'home.progress.collection': '收集进度',
    'home.progress.fishdex': '图鉴进度',
    'home.progress.unlocked.fish': '已解锁鱼类',
    'home.progress.completion': '完成度',
    'home.progress.no.data': '暂无数据',

    // Fishdex Screen
    'fishdex.title': '鱼类图鉴',
    'fishdex.subtitle': '发现并收集各种鱼类',
    'fishdex.search': '搜索鱼类...',
    'fishdex.filter.all': '全部',
    'fishdex.filter.unlocked': '已解锁',
    'fishdex.filter.locked': '未解锁',
    'fishdex.filter.new': '新发现',
    'fishdex.filter.freshwater': '淡水',
    'fishdex.filter.saltwater': '海水',
    'fishdex.filter.brackish': '咸淡水',
    'fishdex.locked': '未解锁',
    'fishdex.new': '新发现!',
    'fishdex.rare': '稀有',
    'fishdex.common': '常见',
    'fishdex.uncommon': '不常见',
    'fishdex.legendary': '传说',
    'fishdex.empty.title': '未找到鱼类',
    'fishdex.empty.subtitle': '尝试调整搜索或筛选条件',
    'fishdex.unlocked': '已解锁',
    'fishdex.unlocked.only': '仅已解锁',
    'fishdex.rarity': '稀有度',
    'fishdex.edibility': '可食用性',
    'fishdex.water.types': '水域类型',
    'fishdex.loading.description': '正在载入鱼类图鉴数据',
    'fishdex.initialize.data': '初始化数据',
    'fishdex.no.matches.title': '没有匹配的鱼类',
    'fishdex.no.matches.description': '尝试调整筛选条件',

    // Equipment Screen
    'equipment.title': '钓鱼装备',
    'equipment.subtitle': '管理你的钓鱼装备组合',
    'equipment.create': '创建装备组合',
    'equipment.filter.all': '全部',
    'equipment.filter.favorites': '收藏',
    'equipment.filter.recent': '最近',
    'equipment.empty.title': '暂无装备组合',
    'equipment.empty.subtitle': '创建你的第一个钓鱼装备组合',
    'equipment.stats.usage': '使用次数',
    'equipment.stats.success': '成功率',
    'equipment.stats.catches': '钓获数',
    'equipment.actions.edit': '编辑',
    'equipment.actions.delete': '删除',
    'equipment.delete.title': '确认删除',
    'equipment.delete.message': '确定要删除装备组合「{name}」吗？',
    'equipment.delete.cancel': '取消',
    'equipment.delete.confirm': '删除',

    // Equipment Creation/Edit
    'equipment.create.title': '创建装备组合',
    'equipment.edit.title': '编辑装备组合',
    'equipment.form.name': '名称',
    'equipment.form.name.placeholder': '输入装备组合名称',
    'equipment.form.description': '描述',
    'equipment.form.description.placeholder': '输入装备描述（可选）',
    'equipment.form.rod': '钓竿',
    'equipment.form.rod.placeholder': '例如：手竿 4.5米 或 海竿 3.6米',
    'equipment.form.reel': '渔轮',
    'equipment.form.reel.placeholder': '例如：纺车轮 2000型 或 水滴轮',
    'equipment.form.line': '钓线',
    'equipment.form.line.placeholder': '例如：尼龙线 2.0号 或 PE线 1.5号',
    'equipment.form.hook': '鱼钩',
    'equipment.form.hook.placeholder': '例如：袖钩 5号 或 新关东 1号',
    'equipment.form.bait': '饵料',
    'equipment.form.bait.placeholder': '选择或输入鱼饵',
    'equipment.form.water_types': '适用水域',
    'equipment.form.tags': '标签',
    'equipment.form.tags.placeholder': '添加标签（用逗号分隔）',
    'equipment.form.save': '保存',
    'equipment.form.cancel': '取消',
    'equipment.basic.info': '基本信息',
    'equipment.config': '装备配置',
    'equipment.validation.name.required': '请输入装备组合名称',
    'equipment.validation.rod.required': '请选择钓竿',
    'equipment.validation.reel.required': '请选择渔轮',
    'equipment.validation.line.required': '请选择钓线',
    'equipment.validation.hook.required': '请选择鱼钩',
    'equipment.validation.bait.required': '请选择饵料',
    'equipment.validation.water.type.required': '请至少选择一种适用水域类型',
    'equipment.update.success': '装备组合已更新',
    'equipment.create.success': '装备组合已创建',
    'equipment.save.failed': '保存失败，请重试',
    'equipment.form.set.default': '设为默认装备',
    'equipment.form.set.default.description': '在记录钓获时优先显示',
    'equipment.tags.favorite': '收藏',
    'equipment.tags.common': '常用',

    // Equipment form additional fields
    'equipment.form.accessories': '配件附件',
    'equipment.form.accessories.placeholder': '添加配件（抄网、鱼护等）',
    'equipment.form.water.types.label': '适用水域',
    'equipment.form.target.fish': '目标鱼种',
    'equipment.form.target.fish.add': '添加目标鱼种',
    'equipment.form.target.fish.placeholder': '输入鱼种名称',
    'equipment.form.target.fish.common': '常见鱼种：',
    'equipment.form.target.fish.select': '选择目标鱼种',
    'equipment.form.tags.label': '标签',
    'equipment.form.tags.add.placeholder': '添加标签',
    'equipment.form.tags.common': '常用标签：',

    // Common fish names
    'fish.crucian.carp': '鲫鱼',
    'fish.common.carp': '鲤鱼',
    'fish.grass.carp': '草鱼',
    'fish.bream': '鳊鱼',
    'fish.black.carp': '青鱼',
    'fish.silver.carp': '鲢鱼',
    'fish.bighead.carp': '鳙鱼',
    'fish.snakehead': '黑鱼',
    'fish.bass': '鲈鱼',
    'fish.mandarin.fish': '鳜鱼',
    'fish.yellow.catfish': '黄颡鱼',
    'fish.catfish': '鲶鱼',
    'fish.tilapia': '罗非鱼',
    'fish.ribbon.fish': '带鱼',
    'fish.yellow.croaker': '黄花鱼',

    // Common tags
    'tag.beginner.friendly': '新手友好',
    'tag.economical': '经济实惠',
    'tag.wild.fishing': '野钓',
    'tag.casting': '抛投',
    'tag.sea.fishing': '海钓',
    'tag.rock.fishing': '矶钓',
    'tag.lure.fishing': '路亚',
    'tag.night.fishing': '夜钓',

    // Achievements Screen
    'achievements.title': '成就系统',
    'achievements.subtitle': '解锁各种钓鱼成就',
    'achievements.filter.all': '全部',
    'achievements.filter.unlocked': '已解锁',
    'achievements.filter.locked': '未解锁',
    'achievements.filter.bronze': '铜牌',
    'achievements.filter.silver': '银牌',
    'achievements.filter.gold': '金牌',
    'achievements.progress': '进度',
    'achievements.unlocked': '成就解锁',
    'achievements.locked': '未解锁',
    'achievements.reward': '奖励',
    'achievements.empty.title': '暂无成就',
    'achievements.empty.subtitle': '继续钓鱼来解锁成就',
    'achievements.stats': '成就统计',
    'achievements.category.species': '物种',
    'achievements.category.quantity': '数量',
    'achievements.category.size': '尺寸',
    'achievements.category.location': '地点',
    'achievements.category.special': '特殊',
    'achievements.completion.rate': '完成率',
    'achievements.remaining': '剩余成就',
    'achievements.no.data.title': '暂无成就数据',
    'achievements.no.data.description': '成就系统正在加载中',
    'achievements.no.unlocked.title': '还没有解锁任何成就',
    'achievements.no.unlocked.description': '开始钓鱼来获得你的第一个成就吧！',
    'achievements.category.filter': '分类筛选',
    'achievements.show.unlocked.only': '仅显示已解锁',
    'achievements.list.title': '成就列表',
    'achievements.tier.bronze': '铜',
    'achievements.tier.silver': '银',
    'achievements.tier.gold': '金',

    // Individual achievements
    'achievement.first.catch.name': '初次垂钓',
    'achievement.first.catch.description': '记录你的第一次钓鱼',
    'achievement.species.collector.name': '物种收集家',
    'achievement.species.collector.description': '解锁不同种类的鱼',
    'achievement.quantity.master.name': '钓鱼达人',
    'achievement.quantity.master.description': '记录大量钓鱼次数',
    'achievement.size.hunter.name': '大鱼猎手',
    'achievement.size.hunter.description': '钓到指定重量的大鱼',
    'achievement.streak.keeper.name': '连钓记录',
    'achievement.streak.keeper.description': '保持连续钓鱼的天数',
    'achievement.explorer.name': '水域探索者',
    'achievement.explorer.description': '在不同类型的水域钓鱼',
    'achievement.air.force.name': '空军部队',
    'achievement.air.force.description': '连续出钓但空手而归的次数',
    'achievement.early.bird.name': '早起的鸟儿',
    'achievement.early.bird.description': '在早上6点前开始钓鱼',
    'achievement.night.owl.name': '夜猫子',
    'achievement.night.owl.description': '在晚上10点后还在钓鱼',
    'achievement.weather.warrior.name': '风雨无阻',
    'achievement.weather.warrior.description': '在恶劣天气下钓鱼',
    'achievement.small.fish.specialist.name': '小鱼专家',
    'achievement.small.fish.specialist.description': '专门钓小于10cm的鱼',
    'achievement.catch.and.release.name': '保护主义者',
    'achievement.catch.and.release.description': '放生鱼类的数量',
    'achievement.lucky.fisherman.name': '欧皇本皇',
    'achievement.lucky.fisherman.description': '钓到传说级稀有鱼类',
    'achievement.multi.species.name': '一网打尽',
    'achievement.multi.species.description': '同一天钓到不同种类的鱼',
    'achievement.equipment.hoarder.name': '装备党',
    'achievement.equipment.hoarder.description': '记录时使用不同种类的装备',
    'achievement.photo.enthusiast.name': '摄影达人',
    'achievement.photo.enthusiast.description': '为钓鱼记录拍摄大量照片',
    'achievement.season.master.name': '四季钓翁',
    'achievement.season.master.description': '在一年四季都有钓鱼记录',
    'achievement.persistent.angler.name': '坚持不懈',
    'achievement.persistent.angler.description': '单次钓鱼时长超过指定小时',
    
    // Achievement Detail Screen
    'achievement.detail.title': '成就详情',
    'achievement.detail.requirement': '要求',
    'achievement.detail.progress': '进度',
    'achievement.detail.reward': '奖励',
    'achievement.detail.category': '类别',
    'achievement.detail.unlocked.on': '解锁于',
    'achievement.detail.locked': '未解锁',
    'achievement.detail.unlocked': '已解锁',
    'achievement.detail.hidden': '这是一个隐藏成就',
    'achievement.detail.tiers.title': '成就等级',
    'achievement.detail.not.found': '成就未找到',

    // Achievement System

    // Stats Screen
    'stats.title': '钓鱼统计',
    'stats.subtitle': '分析你的钓鱼数据',
    'stats.overview': '总体概况',
    'stats.catches.total': '总钓获数',
    'stats.species.total': '总鱼种数',
    'stats.achievements.total': '总成就数',
    'stats.time.total': '总钓鱼时长',
    'stats.charts.monthly': '月度钓获',
    'stats.charts.species': '鱼种分布',
    'stats.charts.locations': '地点统计',
    'stats.charts.equipment': '装备使用',
    'stats.no.data.title': '暂无统计数据',
    'stats.no.data.description': '开始记录钓鱼来查看你的统计信息',
    'stats.start.recording': '开始记录',
    'stats.overview.stats': '总览统计',
    'stats.total.weight': '总重量',
    'stats.total.length': '总长度',
    'stats.unique.species': '不同物种',
    'stats.collection.progress': '收集进度',
    'stats.unlocked.fish': '已解锁鱼类',
    'stats.average.weight': '平均重量',
    'stats.average.length': '平均长度',
    'stats.rarity.distribution': '稀有度分布',
    'stats.personal.bests': '个人纪录',
    'stats.heaviest.record': '最重记录',
    'stats.longest.record': '最长记录',
    'stats.activity.stats': '活动统计',
    'stats.most.active.month': '最活跃月份',
    'stats.recent.30.days': '近30天活跃度',
    'stats.count.with.percentage': '{count}条 ({percentage}%)',
    'stats.times.with.count': '{count}次',
    'stats.month.1': '1月',
    'stats.month.2': '2月',
    'stats.month.3': '3月',
    'stats.month.4': '4月',
    'stats.month.5': '5月',
    'stats.month.6': '6月',
    'stats.month.7': '7月',
    'stats.month.8': '8月',
    'stats.month.9': '9月',
    'stats.month.10': '10月',
    'stats.month.11': '11月',
    'stats.month.12': '12月',
    'stats.best.fishing.hour': '最佳钓鱼时段',
    'stats.streak.consistency': '连击与持续性',
    'stats.current.streak': '当前连击',
    'stats.longest.streak': '最长连击',
    'stats.consecutive.days': '连续天数',
    'stats.best.record': '最佳记录',
    'stats.location.analytics': '地点分析',
    'stats.favorite.spot': '最爱钓点',
    'stats.no.location': '无位置信息',
    'stats.total.locations': '钓点总数',
    'stats.different.spots': '个不同钓点',
    'stats.average.catches.per.trip': '平均每次 {average} 条',
    'stats.seasonal.analysis': '季节分析',
    'stats.season.spring': '春季',
    'stats.season.summer': '夏季',
    'stats.season.autumn': '秋季',
    'stats.season.winter': '冬季',
    'stats.skunked.title': '空军统计',
    'stats.skunked.count': '空军次数',
    'stats.skunked.rate': '空军比例',

    // Log Screen
    'log.title': '记录钓获',
    'log.subtitle': '记录你的钓鱼收获',
    'log.fish.select': '选择鱼类',
    'log.fish.search': '搜索鱼类...',
    'log.photo.add': '添加照片',
    'log.photo.camera': '拍照',
    'log.photo.library': '从相册选择',
    'log.location.current': '使用当前位置',
    'log.location.manual': '手动输入位置',
    'log.measurements.length': '长度 (cm)',
    'log.measurements.weight': '重量 (g)',
    'log.equipment.select': '选择装备',
    'log.notes': '备注',
    'log.notes.placeholder': '添加钓鱼笔记...',
    'log.save': '保存记录',
    'log.cancel': '取消',
    'log.success': '钓获记录已保存',
    'log.weather.conditions': '天气条件',
    'log.weather.temperature': '温度',
    'log.weather.wind': '风速',
    'log.weather.tide': '潮汐',
    'log.weather.waves': '浪高',
    'log.weather.humidity': '湿度',
    'log.weather.pressure': '气压',
    'log.weather.loading': '正在获取天气数据...',
    'log.saved': '记录已保存',
    'log.weather.error': '无法获取天气信息',
    // Tide labels
    'tide.highest': '最高潮',
    'tide.lowest': '最低潮',
    'weather.source': '数据来源',
    'weather.source.bom': 'BOM',
    'weather.source.open_meteo': 'Open‑Meteo',
    'weather.source.unavailable': '不可用',
    'log.skunked': '空军',
    'log.skunked.description': '没有钓到鱼',
    'log.start.fishing': '开始钓鱼',
    'log.validation.fish.required': '请先选择鱼类',

    // Common
    'common.no.data': '暂无数据',
    'common.not.found': '未找到',

    // Logs Screen
    'logs.title': '钓鱼日志',
    'logs.subtitle': '浏览和管理你的钓鱼记录',
    'logs.view.button': '查看钓鱼日志',
    'logs.detail.title': '钓鱼记录',
    'logs.detail.record.again': '再次记录',
    'logs.empty.title': '还没有钓鱼记录',
    'logs.empty.description': '从记录一次钓鱼开始吧',
    'logs.empty.action': '去记录',
    'logs.item.skunked': '空军记录',
    'logs.item.unknown': '未知鱼类',

    // Fish Detail Screen
    'fish.detail.overview': '概览',
    'fish.detail.habitat': '栖息地',
    'fish.detail.characteristics': '特征',
    'fish.detail.regulations': '钓鱼规定',
    'fish.detail.catches': '我的钓获',
    'fish.detail.rarity': '稀有度',
    'fish.detail.length': '长度',
    'fish.detail.weight': '重量',
    'fish.detail.water_type': '水域类型',
    'fish.detail.season': '季节',
    'fish.detail.bait': '推荐鱼饵',
    'fish.detail.no_catches': '暂无钓获记录',
    'fish.detail.add_catch': '添加钓获',
    'fish.detail.not.found.title': '鱼类未找到',
    'fish.detail.not.found.description': '无法找到指定的鱼类信息',
    'fish.detail.unknown': 'UNKNOWN',
    'fish.detail.image.id': '图片ID',
    'fish.detail.basic.info': '基本信息',
    'fish.detail.scientific.name': '学名',
    'fish.detail.family': '科属',
    'fish.detail.local.names': '别名',
    'fish.detail.unlock.message': '钓获此鱼类后将解锁个人记录',
    'fish.detail.stats': '属性数据',
    'fish.detail.lifespan': '寿命',
    'fish.detail.years': '年',
    'fish.detail.max.weight': '最大',
    'fish.detail.difficulty': '难度',
    'fish.detail.water.types': '水域类型',
    'fish.detail.regions': '分布地区',
    'fish.detail.seasons': '活跃季节',
    'fish.detail.month': '月',
    'fish.detail.min.size': '最小尺寸',
    'fish.detail.daily.limit': '日限制',
    'fish.detail.possession.limit': '持有限制',
    'fish.detail.fish.count': '尾',
    'fish.detail.closed.seasons': '禁钓期',
    'fish.detail.special.rules': '特殊规定',
    'fish.detail.personal.record': '个人记录',
    'fish.detail.caught.times': '已钓获 {count} 次',
    'fish.detail.best.record': '最佳记录',
    'fish.detail.catch.time': '钓获时间',
    'fish.detail.edibility': '食用信息',
    'fish.detail.taste': '口感',
    'fish.detail.cooking.methods': '烹饪方法',
    'fish.detail.notes': '备注',
    'fish.detail.behavior': '行为特征',
    'fish.detail.active.time': '活跃时间',
    'fish.detail.active.day': '白天',
    'fish.detail.active.night': '夜间',
    'fish.detail.active.both': '全天',
    'fish.detail.feeding.habits': '食性',

    // Difficulty levels
    'difficulty.1': '简单',
    'difficulty.2': '容易',
    'difficulty.3': '普通',
    'difficulty.4': '困难',
    'difficulty.5': '专家',

    // Settings Screen
    'settings.title': '设置',
    'settings.subtitle': '个性化你的 FishFlow 体验',
    'settings.language': '语言',
    'settings.language.subtitle': '选择应用语言',
    'settings.theme': '主题',
    'settings.theme.subtitle': '选择应用主题',
    'settings.theme.light': '浅色',
    'settings.theme.dark': '深色',
    'settings.theme.system': '跟随系统',
    'settings.notifications': '通知',
    'settings.notifications.subtitle': '管理通知设置',
    'settings.notifications.achievements': '成就通知',
    'settings.notifications.reminders': '钓鱼提醒',
    'settings.privacy': '隐私',
    'settings.privacy.subtitle': '管理隐私设置',
    'settings.privacy.location': '位置信息',
    'settings.privacy.photos': '照片权限',
    'settings.about': '关于',
    'settings.about.version': '版本',
    'settings.about.feedback': '反馈',
    'settings.about.support': '支持',
    'settings.data': '数据管理',
    'settings.data.export': '导出数据',
    'settings.data.import': '导入数据',
    'settings.data.clear': '清除数据',
    'settings.data.clear.warning': '此操作将删除所有数据，无法撤销',
    'settings.fishing': '钓鱼设置',
    // Removed fishing start date strings
    'settings.notifications.weather': '天气通知',
    'settings.privacy.share.achievements': '分享成就',
    'settings.privacy.share.stats': '分享统计',
    // Removed fishing start date strings
    'settings.error.invalid.date': '请输入有效的日期格式 (YYYY-MM-DD)',
    'settings.rpg.frames': 'RPG边框',
    'settings.rpg.frames.subtitle': '启用装饰性金色边框',

    // Common
    'common.search': '搜索',
    'common.filter': '筛选',
    'common.sort': '排序',
    'common.save': '保存',
    'common.cancel': '取消',
    'common.delete': '删除',
    'common.edit': '编辑',
    'common.add': '添加',
    'common.done': '完成',
    'common.ok': '确定',
    'common.press': '点击查看',
    'common.yes': '是',
    'common.no': '否',
    'common.loading': '加载中...',
    'common.error': '错误',
    'common.success': '成功',
    'common.empty': '暂无数据',
    'common.retry': '重试',
    'common.back': '返回',
    'common.close': '关闭',
    'common.total': '总计',
    'common.showing': '显示',
    'common.name': '名称',
    'common.recent': '最近',
    'common.clear': '清除',
    'common.select': '请选择',
    'common.clear.search': '清除搜索',
    'common.clear.filters': '清除筛选',
    'common.none': '无',
    'common.unknown': '未知',
    'common.notice': '提示',

    // Water Types
    'water.freshwater': '淡水',
    'water.saltwater': '海水',
    'water.brackish': '咸淡水',
    'water.river': '河流',
    'water.lake': '湖泊',
    'water.reservoir': '水库',
    'water.pond': '池塘',
    'water.stream': '溪流',
    'water.ocean': '海洋',
    'water.estuary': '河口',

    // Measurements
    'measurement.cm': 'cm',
    'measurement.g': 'g',
    'measurement.kg': 'kg',
    'measurement.m': 'm',

    // Date/Time
    'date.today': '今天',
    'date.yesterday': '昨天',
    'date.week_ago': '一周前',
    'date.month_ago': '一个月前',
    'time.morning': '上午',
    'time.afternoon': '下午',
    'time.evening': '晚上',
  },
  en: {
    // Navigation
    'nav.home': 'Home',
    'nav.fishdex': 'Fishdex',
    'nav.equipment': 'Equipment',
    'nav.achievements': 'Achievements',
    'nav.stats': 'Stats',
    'nav.settings': 'Settings',
    'nav.log': 'Log',

    // Common
    'common.no.data': 'No Data',
    'common.not.found': 'Not Found',
    // Tide labels
    'tide.highest': 'Highest tide',
    'tide.lowest': 'Lowest tide',

    // Home Screen
    'home.title': 'Home',
    'home.welcome': 'Welcome back to FishFlow',
    'home.subtitle': 'Continue your fishing journey',
    'home.stats.catches': 'Catches',
    'home.stats.species': 'Species',
    'home.stats.achievements': 'Achievements',
    'home.stats.days': 'Fishing Days',
    'home.quick.log': 'Log Catch',
    'home.quick.logs': 'View Fishing Logs',
    'home.quick.fishdex': 'View Fishdex',
    'home.quick.equipment': 'Manage Equipment',
    'home.quick.actions': 'Quick Actions',
    'home.recent.unlocks': 'Recent Unlocks',
    'home.recent.achievements': 'Latest Achievements',
    'home.recent.empty': 'No data available',
    'home.progress.collection': 'Collection Progress',
    'home.progress.fishdex': 'Fishdex Progress',
    'home.progress.unlocked.fish': 'Unlocked Fish',
    'home.progress.completion': 'Completion',
    'home.progress.no.data': 'No data available',

    // Fishdex Screen
    'fishdex.title': 'Fish Encyclopedia',
    'fishdex.subtitle': 'Discover and collect various fish species',
    'fishdex.search': 'Search fish...',
    'fishdex.filter.all': 'All',
    'fishdex.filter.unlocked': 'Unlocked',
    'fishdex.filter.locked': 'Locked',
    'fishdex.filter.new': 'New',
    'fishdex.filter.freshwater': 'Freshwater',
    'fishdex.filter.saltwater': 'Saltwater',
    'fishdex.filter.brackish': 'Brackish',
    'fishdex.locked': 'Locked',
    'fishdex.new': 'New!',
    'fishdex.rare': 'Rare',
    'fishdex.common': 'Common',
    'fishdex.uncommon': 'Uncommon',
    'fishdex.legendary': 'Legendary',
    'fishdex.empty.title': 'No fish found',
    'fishdex.empty.subtitle': 'Try adjusting your search or filters',
    'fishdex.unlocked': 'Unlocked',
    'fishdex.unlocked.only': 'Unlocked Only',
    'fishdex.rarity': 'Rarity',
    'fishdex.edibility': 'Edibility',
    'fishdex.water.types': 'Water Types',
    'fishdex.loading.description': 'Loading fish encyclopedia data',
    'fishdex.initialize.data': 'Initialize Data',
    'fishdex.no.matches.title': 'No matching fish',
    'fishdex.no.matches.description': 'Try adjusting your filters',

    // Equipment Screen
    'equipment.title': 'Fishing Equipment',
    'equipment.subtitle': 'Manage your fishing equipment sets',
    'equipment.create': 'Create Equipment Set',
    'equipment.filter.all': 'All',
    'equipment.filter.favorites': 'Favorites',
    'equipment.filter.recent': 'Recent',
    'equipment.empty.title': 'No equipment sets',
    'equipment.empty.subtitle': 'Create your first fishing equipment set',
    'equipment.stats.usage': 'Usage Count',
    'equipment.stats.success': 'Success Rate',
    'equipment.stats.catches': 'Catches',
    'equipment.actions.edit': 'Edit',
    'equipment.actions.delete': 'Delete',
    'equipment.delete.title': 'Confirm Delete',
    'equipment.delete.message':
      'Are you sure you want to delete the equipment set "{name}"?',
    'equipment.delete.cancel': 'Cancel',
    'equipment.delete.confirm': 'Delete',

    // Equipment Creation/Edit
    'equipment.create.title': 'Create Equipment Set',
    'equipment.edit.title': 'Edit Equipment Set',
    'equipment.form.name': 'Name',
    'equipment.form.name.placeholder': 'Enter equipment set name',
    'equipment.form.description': 'Description',
    'equipment.form.description.placeholder':
      'Enter equipment description (optional)',
    'equipment.form.rod': 'Rod',
    'equipment.form.rod.placeholder': 'e.g.: Hand rod 4.5m or Sea rod 3.6m',
    'equipment.form.reel': 'Reel',
    'equipment.form.reel.placeholder': 'e.g.: Spinning reel 2000 or Baitcaster',
    'equipment.form.line': 'Line',
    'equipment.form.line.placeholder': 'e.g.: Nylon line 2.0 or PE line 1.5',
    'equipment.form.hook': 'Hook',
    'equipment.form.hook.placeholder':
      'e.g.: Sleeve hook #5 or Shinguandong #1',
    'equipment.form.bait': 'Bait',
    'equipment.form.bait.placeholder': 'Select or enter bait',
    'equipment.form.water_types': 'Water Types',
    'equipment.form.tags': 'Tags',
    'equipment.form.tags.placeholder': 'Add tags (comma separated)',
    'equipment.form.save': 'Save',
    'equipment.form.cancel': 'Cancel',
    'equipment.basic.info': 'Basic Information',
    'equipment.config': 'Equipment Configuration',
    'equipment.validation.name.required': 'Please enter equipment set name',
    'equipment.validation.rod.required': 'Please select a rod',
    'equipment.validation.reel.required': 'Please select a reel',
    'equipment.validation.line.required': 'Please select a line',
    'equipment.validation.hook.required': 'Please select a hook',
    'equipment.validation.bait.required': 'Please select bait',
    'equipment.validation.water.type.required':
      'Please select at least one water type',
    'equipment.update.success': 'Equipment set updated successfully',
    'equipment.create.success': 'Equipment set created successfully',
    'equipment.save.failed': 'Save failed, please try again',
    'equipment.form.set.default': 'Set as default equipment',
    'equipment.form.set.default.description':
      'Priority display when logging catches',
    'equipment.tags.favorite': 'Favorite',
    'equipment.tags.common': 'Common',

    // Equipment form additional fields
    'equipment.form.accessories': 'Accessories',
    'equipment.form.accessories.placeholder':
      'Add accessories (landing net, keepnet, etc.)',
    'equipment.form.water.types.label': 'Water Types',
    'equipment.form.target.fish': 'Target Fish',
    'equipment.form.target.fish.add': 'Add Target Fish',
    'equipment.form.target.fish.placeholder': 'Enter fish species name',
    'equipment.form.target.fish.common': 'Common fish species:',
    'equipment.form.target.fish.select': 'Select Target Fish',
    'equipment.form.tags.label': 'Tags',
    'equipment.form.tags.add.placeholder': 'Add tags',
    'equipment.form.tags.common': 'Common tags:',

    // Common fish names
    'fish.crucian.carp': 'Crucian Carp',
    'fish.common.carp': 'Common Carp',
    'fish.grass.carp': 'Grass Carp',
    'fish.bream': 'Bream',
    'fish.black.carp': 'Black Carp',
    'fish.silver.carp': 'Silver Carp',
    'fish.bighead.carp': 'Bighead Carp',
    'fish.snakehead': 'Snakehead',
    'fish.bass': 'Bass',
    'fish.mandarin.fish': 'Mandarin Fish',
    'fish.yellow.catfish': 'Yellow Catfish',
    'fish.catfish': 'Catfish',
    'fish.tilapia': 'Tilapia',
    'fish.ribbon.fish': 'Ribbon Fish',
    'fish.yellow.croaker': 'Yellow Croaker',

    // Common tags
    'tag.beginner.friendly': 'Beginner Friendly',
    'tag.economical': 'Economical',
    'tag.wild.fishing': 'Wild Fishing',
    'tag.casting': 'Casting',
    'tag.sea.fishing': 'Sea Fishing',
    'tag.rock.fishing': 'Rock Fishing',
    'tag.lure.fishing': 'Lure Fishing',
    'tag.night.fishing': 'Night Fishing',

    // Achievements Screen
    'achievements.title': 'Achievement System',
    'achievements.subtitle': 'Unlock various fishing achievements',
    'achievements.filter.all': 'All',
    'achievements.filter.unlocked': 'Unlocked',
    'achievements.filter.locked': 'Locked',
    'achievements.filter.bronze': 'Bronze',
    'achievements.filter.silver': 'Silver',
    'achievements.filter.gold': 'Gold',
    'achievements.progress': 'Progress',
    'achievements.unlocked': 'Achievement Unlocked',
    'achievements.locked': 'Locked',
    'achievements.reward': 'Reward',
    'achievements.empty.title': 'No achievements',
    'achievements.empty.subtitle': 'Keep fishing to unlock achievements',
    'achievements.stats': 'Achievement Statistics',
    'achievements.category.species': 'Species',
    'achievements.category.quantity': 'Quantity',
    'achievements.category.size': 'Size',
    'achievements.category.location': 'Location',
    'achievements.category.special': 'Special',
    'achievements.completion.rate': 'Completion Rate',
    'achievements.remaining': 'Remaining',
    'achievements.no.data.title': 'No achievement data',
    'achievements.no.data.description': 'Achievement system is loading',
    'achievements.no.unlocked.title': 'No achievements unlocked yet',
    'achievements.no.unlocked.description':
      'Start fishing to earn your first achievement!',
    'achievements.category.filter': 'Category Filter',
    'achievements.show.unlocked.only': 'Show Unlocked Only',
    'achievements.list.title': 'Achievement List',
    'achievements.tier.bronze': 'Bronze',
    'achievements.tier.silver': 'Silver',
    'achievements.tier.gold': 'Gold',

    // Individual achievements
    'achievement.first.catch.name': 'First Catch',
    'achievement.first.catch.description': 'Record your first fishing trip',
    'achievement.species.collector.name': 'Species Collector',
    'achievement.species.collector.description':
      'Unlock different species of fish',
    'achievement.quantity.master.name': 'Fishing Master',
    'achievement.quantity.master.description': 'Record numerous fishing trips',
    'achievement.size.hunter.name': 'Big Fish Hunter',
    'achievement.size.hunter.description': 'Catch fish of specified weight',
    'achievement.streak.keeper.name': 'Streak Keeper',
    'achievement.streak.keeper.description':
      'Maintain consecutive fishing days',
    'achievement.explorer.name': 'Water Explorer',
    'achievement.explorer.description':
      'Fish in different types of water bodies',
    'achievement.air.force.name': 'Air Force',
    'achievement.air.force.description':
      'Consecutive fishing trips with no catch',
    'achievement.early.bird.name': 'Early Bird',
    'achievement.early.bird.description': 'Start fishing before 6 AM',
    'achievement.night.owl.name': 'Night Owl',
    'achievement.night.owl.description': 'Still fishing after 10 PM',
    'achievement.weather.warrior.name': 'Weather Warrior',
    'achievement.weather.warrior.description':
      'Fish in harsh weather conditions',
    'achievement.small.fish.specialist.name': 'Small Fish Specialist',
    'achievement.small.fish.specialist.description':
      'Specialize in catching fish under 10cm',
    'achievement.catch.and.release.name': 'Conservationist',
    'achievement.catch.and.release.description': 'Number of fish released',
    
    // Logs Screen
    'logs.title': 'Fishing Logs',
    'logs.subtitle': 'Browse and manage your fishing records',
    'logs.view.button': 'View Fishing Logs',
    'logs.detail.title': 'Fishing Record',
    'logs.detail.record.again': 'Log Again',
    'logs.empty.title': 'No fishing records yet',
    'logs.empty.description': 'Start by logging your first catch',
    'logs.empty.action': 'Log Now',
    'logs.item.skunked': 'Skunked Trip',
    'logs.item.unknown': 'Unknown Fish',
    'achievement.lucky.fisherman.name': 'Lucky Angler',
    'achievement.lucky.fisherman.description': 'Catch legendary rare fish',
    'achievement.multi.species.name': 'Jack of All Fish',
    'achievement.multi.species.description':
      'Catch different species in one day',
    'achievement.equipment.hoarder.name': 'Gear Head',
    'achievement.equipment.hoarder.description':
      'Use different types of equipment',
    'achievement.photo.enthusiast.name': 'Photo Enthusiast',
    'achievement.photo.enthusiast.description':
      'Take many photos of fishing records',
    'achievement.season.master.name': 'Four Season Angler',
    'achievement.season.master.description': 'Fish in all four seasons',
    'achievement.persistent.angler.name': 'Persistent Angler',
    'achievement.persistent.angler.description':
      'Single fishing session over specified hours',
      
    // Achievement Detail Screen  
    'achievement.detail.title': 'Achievement Details',
    'achievement.detail.requirement': 'Requirement',
    'achievement.detail.progress': 'Progress',
    'achievement.detail.reward': 'Reward',
    'achievement.detail.category': 'Category',
    'achievement.detail.unlocked.on': 'Unlocked on',
    'achievement.detail.locked': 'Locked',
    'achievement.detail.unlocked': 'Unlocked',
    'achievement.detail.hidden': 'This is a hidden achievement',
    'achievement.detail.tiers.title': 'Achievement Tiers',
    'achievement.detail.not.found': 'Achievement not found',

    // Achievement System

    // Stats Screen
    'stats.title': 'Fishing Statistics',
    'stats.subtitle': 'Analyze your fishing data',
    'stats.overview': 'Overview',
    'stats.catches.total': 'Total Catches',
    'stats.species.total': 'Total Species',
    'stats.achievements.total': 'Total Achievements',
    'stats.time.total': 'Total Fishing Time',
    'stats.charts.monthly': 'Monthly Catches',
    'stats.charts.species': 'Species Distribution',
    'stats.charts.locations': 'Location Statistics',
    'stats.charts.equipment': 'Equipment Usage',
    'stats.no.data.title': 'No Statistics Data',
    'stats.no.data.description':
      'Start recording fishing to view your statistics',
    'stats.start.recording': 'Start Recording',
    'stats.overview.stats': 'Overview Statistics',
    'stats.total.weight': 'Total Weight',
    'stats.total.length': 'Total Length',
    'stats.unique.species': 'Unique Species',
    'stats.collection.progress': 'Collection Progress',
    'stats.unlocked.fish': 'Unlocked Fish',
    'stats.average.weight': 'Average Weight',
    'stats.average.length': 'Average Length',
    'stats.rarity.distribution': 'Rarity Distribution',
    'stats.personal.bests': 'Personal Records',
    'stats.heaviest.record': 'Heaviest Record',
    'stats.longest.record': 'Longest Record',
    'stats.activity.stats': 'Activity Statistics',
    'stats.most.active.month': 'Most Active Month',
    'stats.recent.30.days': 'Recent 30 Days Activity',
    'stats.count.with.percentage': '{count} fish ({percentage}%)',
    'stats.times.with.count': '{count} times',
    'stats.month.1': 'Jan',
    'stats.month.2': 'Feb',
    'stats.month.3': 'Mar',
    'stats.month.4': 'Apr',
    'stats.month.5': 'May',
    'stats.month.6': 'Jun',
    'stats.month.7': 'Jul',
    'stats.month.8': 'Aug',
    'stats.month.9': 'Sep',
    'stats.month.10': 'Oct',
    'stats.month.11': 'Nov',
    'stats.month.12': 'Dec',
    'stats.best.fishing.hour': 'Best Fishing Hour',
    'stats.streak.consistency': 'Streak & Consistency',
    'stats.current.streak': 'Current Streak',
    'stats.longest.streak': 'Longest Streak',
    'stats.consecutive.days': 'Consecutive Days',
    'stats.best.record': 'Best Record',
    'stats.location.analytics': 'Location Analytics',
    'stats.favorite.spot': 'Favorite Spot',
    'stats.no.location': 'No Location Data',
    'stats.total.locations': 'Total Locations',
    'stats.different.spots': 'Different Spots',
    'stats.average.catches.per.trip': 'Avg {average} per trip',
    'stats.seasonal.analysis': 'Seasonal Analysis',
    'stats.season.spring': 'Spring',
    'stats.season.summer': 'Summer',
    'stats.season.autumn': 'Autumn',
    'stats.season.winter': 'Winter',
    'stats.skunked.title': 'Skunked Stats',
    'stats.skunked.count': 'Skunked Count',
    'stats.skunked.rate': 'Skunk Rate',

    // Log Screen
    'log.title': 'Log Catch',
    'log.subtitle': 'Record your fishing catch',
    'log.fish.select': 'Select Fish',
    'log.fish.search': 'Search fish...',
    'log.photo.add': 'Add Photo',
    'log.photo.camera': 'Take Photo',
    'log.photo.library': 'Choose from Library',
    'log.location.current': 'Use Current Location',
    'log.location.manual': 'Enter Location Manually',
    'log.measurements.length': 'Length (cm)',
    'log.measurements.weight': 'Weight (g)',
    'log.equipment.select': 'Select Equipment',
    'log.notes': 'Notes',
    'log.notes.placeholder': 'Add fishing notes...',
    'log.save': 'Save Record',
    'log.cancel': 'Cancel',
    'log.success': 'Catch record saved',
    'log.weather.conditions': 'Weather Conditions',
    'log.weather.temperature': 'Temperature',
    'log.weather.wind': 'Wind Speed',
    'log.weather.tide': 'Tide',
    'log.weather.waves': 'Wave Height',
    'log.weather.humidity': 'Humidity',
    'log.weather.pressure': 'Pressure',
    'log.weather.loading': 'Fetching weather data...',
    'log.saved': 'Saved',
    'log.weather.error': 'Unable to get weather information',
    'weather.source': 'Source',
    'weather.source.bom': 'BOM',
    'weather.source.open_meteo': 'Open‑Meteo',
    'weather.source.unavailable': 'Unavailable',
    'log.skunked': 'Skunked',
    'log.skunked.description': 'No fish caught',
    'log.start.fishing': 'Start Fishing',
    'log.validation.fish.required': 'Please select a fish first',

    // Fish Detail Screen
    'fish.detail.overview': 'Overview',
    'fish.detail.habitat': 'Habitat',
    'fish.detail.characteristics': 'Characteristics',
    'fish.detail.regulations': 'Fishing Regulations',
    'fish.detail.catches': 'My Catches',
    'fish.detail.rarity': 'Rarity',
    'fish.detail.length': 'Length',
    'fish.detail.weight': 'Weight',
    'fish.detail.water_type': 'Water Type',
    'fish.detail.season': 'Season',
    'fish.detail.bait': 'Recommended Bait',
    'fish.detail.no_catches': 'No catch records',
    'fish.detail.add_catch': 'Add Catch',
    'fish.detail.not.found.title': 'Fish Not Found',
    'fish.detail.not.found.description':
      'Unable to find the specified fish information',
    'fish.detail.unknown': 'UNKNOWN',
    'fish.detail.image.id': 'Image ID',
    'fish.detail.basic.info': 'Basic Information',
    'fish.detail.scientific.name': 'Scientific Name',
    'fish.detail.family': 'Family',
    'fish.detail.local.names': 'Local Names',
    'fish.detail.unlock.message': 'Catch this fish to unlock personal records',
    'fish.detail.stats': 'Stats',

    'fish.detail.lifespan': 'Lifespan',
    'fish.detail.years': ' years',

    'fish.detail.max.weight': 'Max',
    'fish.detail.difficulty': 'Difficulty',

    'fish.detail.water.types': 'Water Types',
    'fish.detail.regions': 'Distribution',
    'fish.detail.seasons': 'Active Seasons',
    'fish.detail.month': '',

    'fish.detail.min.size': 'Min Size',
    'fish.detail.daily.limit': 'Daily Limit',
    'fish.detail.possession.limit': 'Possession Limit',
    'fish.detail.fish.count': '',
    'fish.detail.closed.seasons': 'Closed Seasons',
    'fish.detail.special.rules': 'Special Rules',
    'fish.detail.personal.record': 'Personal Record',
    'fish.detail.caught.times': 'Caught {count} times',
    'fish.detail.best.record': 'Best Record',
    'fish.detail.catch.time': 'Catch Time',
    'fish.detail.edibility': 'Edibility',
    'fish.detail.taste': 'Taste',
    'fish.detail.cooking.methods': 'Cooking Methods',
    'fish.detail.notes': 'Notes',
    'fish.detail.behavior': 'Behavior',
    'fish.detail.active.time': 'Active Time',
    'fish.detail.active.day': 'Day',
    'fish.detail.active.night': 'Night',
    'fish.detail.active.both': 'Both',
    'fish.detail.feeding.habits': 'Feeding Habits',

    // Difficulty levels
    'difficulty.1': 'Easy',
    'difficulty.2': 'Simple',
    'difficulty.3': 'Normal',
    'difficulty.4': 'Hard',
    'difficulty.5': 'Expert',

    // Settings Screen
    'settings.title': 'Settings',
    'settings.subtitle': 'Customize your FishFlow experience',
    'settings.language': 'Language',
    'settings.language.subtitle': 'Select app language',
    'settings.theme': 'Theme',
    'settings.theme.subtitle': 'Select app theme',
    'settings.theme.light': 'Light',
    'settings.theme.dark': 'Dark',
    'settings.theme.system': 'Follow System',
    'settings.notifications': 'Notifications',
    'settings.notifications.subtitle': 'Manage notification settings',
    'settings.notifications.achievements': 'Achievement Notifications',
    'settings.notifications.reminders': 'Fishing Reminders',
    'settings.privacy': 'Privacy',
    'settings.privacy.subtitle': 'Manage privacy settings',
    'settings.privacy.location': 'Location Services',
    'settings.privacy.photos': 'Photo Permissions',
    'settings.about': 'About',
    'settings.about.version': 'Version',
    'settings.about.feedback': 'Feedback',
    'settings.about.support': 'Support',
    'settings.data': 'Data Management',
    'settings.data.export': 'Export Data',
    'settings.data.import': 'Import Data',
    'settings.data.clear': 'Clear Data',
    'settings.data.clear.warning':
      'This action will delete all data and cannot be undone',
    'settings.fishing': 'Fishing Settings',
    // Removed fishing start date strings
    'settings.notifications.weather': 'Weather Notifications',
    'settings.privacy.share.achievements': 'Share Achievements',
    'settings.privacy.share.stats': 'Share Statistics',
    // Removed fishing start date strings
    'settings.error.invalid.date':
      'Please enter a valid date format (YYYY-MM-DD)',
    'settings.rpg.frames': 'RPG Frames',
    'settings.rpg.frames.subtitle': 'Enable decorative golden frames',

    // Common
    'common.search': 'Search',
    'common.filter': 'Filter',
    'common.sort': 'Sort',
    'common.save': 'Save',
    'common.cancel': 'Cancel',
    'common.delete': 'Delete',
    'common.edit': 'Edit',
    'common.add': 'Add',
    'common.done': 'Done',
    'common.ok': 'OK',
    'common.press': 'Tap to view',
    'common.yes': 'Yes',
    'common.no': 'No',
    'common.loading': 'Loading...',
    'common.error': 'Error',
    'common.success': 'Success',
    'common.empty': 'No data',
    'common.retry': 'Retry',
    'common.back': 'Back',
    'common.close': 'Close',
    'common.total': 'Total',
    'common.showing': 'Showing',
    'common.name': 'Name',
    'common.recent': 'Recent',
    'common.clear': 'Clear',
    'common.select': 'Select',
    'common.clear.search': 'Clear Search',
    'common.clear.filters': 'Clear Filters',
    'common.none': 'None',
    'common.unknown': 'Unknown',
    'common.notice': 'Notice',

    // Water Types
    'water.freshwater': 'Freshwater',
    'water.saltwater': 'Saltwater',
    'water.brackish': 'Brackish',
    'water.river': 'River',
    'water.lake': 'Lake',
    'water.reservoir': 'Reservoir',
    'water.pond': 'Pond',
    'water.stream': 'Stream',
    'water.ocean': 'Ocean',
    'water.estuary': 'Estuary',

    // Measurements
    'measurement.cm': 'cm',
    'measurement.g': 'g',
    'measurement.kg': 'kg',
    'measurement.m': 'm',

    // Date/Time
    'date.today': 'Today',
    'date.yesterday': 'Yesterday',
    'date.week_ago': '1 week ago',
    'date.month_ago': '1 month ago',
    'time.morning': 'AM',
    'time.afternoon': 'PM',
    'time.evening': 'Evening',
  },
};

// Keep a module-level snapshot for places calling `t()` directly.
// Initialize from store preference to avoid defaulting to Chinese.
let currentLanguage: Language = (() => {
  try {
    const pref = useAppStore.getState().userPreferences?.appearance?.language;
    return (pref === 'zh' || pref === 'en' || pref === 'system') ? pref : 'en';
  } catch {
    return 'en';
  }
})();

export const initializeLanguage = async (): Promise<Language> => {
  try {
    const storedLanguage = await AsyncStorage.getItem(LANGUAGE_STORAGE_KEY);
    if (
      storedLanguage &&
      (storedLanguage === 'zh' || storedLanguage === 'en')
    ) {
      currentLanguage = storedLanguage as Language;
      // Sync into global store preferences so UI re-renders accordingly
      const store = useAppStore.getState();
      const prev = store.userPreferences;
      const effective: 'zh' | 'en' = (currentLanguage === 'zh' || currentLanguage === 'en') ? currentLanguage : (prev.appearance.language || 'en');
      store.updateUserPreferences({
        appearance: { ...prev.appearance, language: effective },
      });
    }
  } catch (error) {
    console.warn('Failed to load language preference:', error);
  }
  return currentLanguage;
};

export const setLanguage = async (language: Language): Promise<void> => {
  try {
    currentLanguage = language;
    await AsyncStorage.setItem(LANGUAGE_STORAGE_KEY, language);
    // Update store so components subscribed via useTranslation re-render
    const store = useAppStore.getState();
    const prev = store.userPreferences;
    const effective: 'zh' | 'en' = (language === 'zh' || language === 'en') ? language : (prev.appearance.language || 'en');
    store.updateUserPreferences({
      appearance: { ...prev.appearance, language: effective },
    });
  } catch (error) {
    console.warn('Failed to save language preference:', error);
  }
};

export const getCurrentLanguage = (): Language => {
  return currentLanguage;
};

export const t = (
  key: TranslationKeys,
  params?: Record<string, string>
): string => {
  const lang = (currentLanguage === 'zh' || currentLanguage === 'en') ? currentLanguage : 'zh';
  const translation = translations[lang][key] || translations.zh[key] || key;

  if (params) {
    return Object.entries(params).reduce((str, [param, value]) => {
      return str.replace(new RegExp(`\\{${param}\\}`, 'g'), value);
    }, translation);
  }

  return translation;
};

export const useTranslation = () => {
  // Subscribe to language in store so any changes trigger re-render
  const language = useAppStore(state => state.userPreferences.appearance.language);

  const changeLanguage = useCallback(async (newLanguage: Language) => {
    await setLanguage(newLanguage);
  }, []);

  const translate = useCallback((key: TranslationKeys, params?: Record<string, string>): string => {
    const langResolved: 'zh' | 'en' = (language === 'zh' || language === 'en') ? language : 'zh';
    const translation = translations[langResolved][key] || translations.zh[key] || key;

    if (__DEV__ && !translations[langResolved][key] && !translations.zh[key]) {
      console.warn(`Translation missing for key: ${key} in language: ${langResolved}`);
    }

    if (params) {
      return Object.entries(params).reduce((str, [param, value]) => {
        return str.replace(new RegExp(`\\{${param}\\}`, 'g'), value);
      }, translation);
    }

    return translation;
  }, [language]);

  return { t: translate, currentLanguage: language, setLanguage: changeLanguage };
};
